/Users/hasanb/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
/Users/hasanb/Desktop/MDX-DOCS/CST-4090/code/hdfs-anomaly-detection/enhanced_scoring_service.py:476: DeprecationWarning: 
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
        
  @app.on_event('startup')
INFO:     Started server process [28627]
INFO:     Waiting for application startup.
2025-09-26 16:07:04,059 - __main__ - INFO - ðŸš€ Starting Real-Time HDFS Anomaly Detection Engine...
2025-09-26 16:07:04,061 - __main__ - INFO -  Database initialized: anomaly_detection.db
2025-09-26 16:07:04,065 - __main__ - INFO - âœ… Connected to Redis at localhost:6379
2025-09-26 16:07:04,101 - httpx - INFO - HTTP Request: GET http://localhost:6333 "HTTP/1.1 200 OK"
2025-09-26 16:07:04,101 - __main__ - INFO - âœ… Connected to Qdrant at localhost:6333
2025-09-26 16:07:04,101 - __main__ - INFO - ðŸ“¥ Loading ensemble model from ./ensemble/models/line_level_ensemble_v2/line_level_ensemble_v2_results.joblib
2025-09-26 16:07:04,731 - __main__ - INFO - âœ… Loaded ensemble with 3 models
2025-09-26 16:07:04,731 - __main__ - INFO - ðŸŽ¯ Model weights for weighted voting:
2025-09-26 16:07:04,731 - __main__ - INFO -    dt: 0.0790
2025-09-26 16:07:04,731 - __main__ - INFO -    mlp: 0.4315
2025-09-26 16:07:04,731 - __main__ - INFO -    sgd: 0.0747
2025-09-26 16:07:04,731 - __main__ - INFO -    qdrant_similarity: 0.4148
2025-09-26 16:07:04,732 - __main__ - INFO - ðŸ“¡ Enhanced Kafka consumer started
2025-09-26 16:07:04,732 - __main__ - INFO - âœ… Real-Time Anomaly Detection Engine ready!
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8003 (Press CTRL+C to quit)
2025-09-26 16:07:04,732 - kafka.conn - INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=bootstrap-0 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-09-26 16:07:04,740 - kafka.conn - INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=bootstrap-0 host=localhost:9092 <checking_api_versions_recv> [IPv6 ('::1', 9092, 0, 0)]>: Broker version identified as 2.6
2025-09-26 16:07:04,740 - kafka.conn - INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=bootstrap-0 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-09-26 16:07:04,740 - kafka.consumer.subscription_state - INFO - Updating subscribed topics to: ('logs',)
2025-09-26 16:07:04,740 - __main__ - INFO - ðŸ“¡ Enhanced Kafka consumer listening to topic: logs
2025-09-26 16:07:04,751 - kafka.conn - INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=1 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-09-26 16:07:04,857 - kafka.conn - INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-09-26 16:07:04,857 - kafka.conn - INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=bootstrap-0 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Closing connection. 
2025-09-26 16:07:04,971 - kafka.cluster - INFO - Coordinator for group/anomaly_engine_1758888424 is BrokerMetadata(nodeId='coordinator-1', host='localhost', port=9092, rack=None)
2025-09-26 16:07:04,971 - kafka.coordinator - INFO - Discovered coordinator coordinator-1 for group anomaly_engine_1758888424
2025-09-26 16:07:04,972 - kafka.coordinator.heartbeat - INFO - Starting new heartbeat thread
2025-09-26 16:07:04,973 - kafka.coordinator.consumer - INFO - Revoking previously assigned partitions set() for group anomaly_engine_1758888424
2025-09-26 16:07:04,973 - kafka.coordinator - INFO - Failed to join group anomaly_engine_1758888424: NodeNotReadyError: coordinator-1
2025-09-26 16:07:04,974 - kafka.conn - INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=coordinator-1 host=localhost:9092 <connecting> [IPv6 ('::1', 9092, 0, 0)]>: connecting to localhost:9092 [('::1', 9092, 0, 0) IPv6]
2025-09-26 16:07:05,076 - kafka.coordinator - INFO - Failed to join group anomaly_engine_1758888424: NodeNotReadyError: coordinator-1
2025-09-26 16:07:05,076 - kafka.conn - INFO - <BrokerConnection client_id=kafka-python-2.2.15, node_id=coordinator-1 host=localhost:9092 <connected> [IPv6 ('::1', 9092, 0, 0)]>: Connection complete.
2025-09-26 16:07:05,179 - kafka.coordinator - INFO - (Re-)joining group anomaly_engine_1758888424
2025-09-26 16:07:05,189 - kafka.coordinator - INFO - Received member id kafka-python-2.2.15-0da5e8f5-7eba-40b3-b98e-2ba8369af83d for group anomaly_engine_1758888424; will retry join-group
2025-09-26 16:07:05,189 - kafka.coordinator - INFO - Failed to join group anomaly_engine_1758888424: [Error 79] MemberIdRequiredError
2025-09-26 16:07:05,189 - kafka.coordinator - INFO - (Re-)joining group anomaly_engine_1758888424
2025-09-26 16:07:05,207 - kafka.coordinator - INFO - Successfully joined group anomaly_engine_1758888424 <Generation 1 (member_id: kafka-python-2.2.15-0da5e8f5-7eba-40b3-b98e-2ba8369af83d, protocol: range)>
2025-09-26 16:07:05,207 - kafka.coordinator - INFO - Elected group leader -- performing partition assignments using range
2025-09-26 16:07:05,218 - kafka.consumer.subscription_state - INFO - Updated partition assignment: [TopicPartition(topic='logs', partition=0)]
2025-09-26 16:07:05,218 - kafka.coordinator.consumer - INFO - Setting newly assigned partitions {TopicPartition(topic='logs', partition=0)} for group anomaly_engine_1758888424
2025-09-26 16:07:05,224 - kafka.consumer.fetcher - INFO - Resetting offset for partition TopicPartition(topic='logs', partition=0) to offset 236035.
INFO:     127.0.0.1:62137 - "POST /cache/clear HTTP/1.1" 200 OK
2025-09-26 16:07:08,192 - httpx - INFO - HTTP Request: GET http://localhost:6333/collections "HTTP/1.1 200 OK"
INFO:     127.0.0.1:62139 - "GET /health HTTP/1.1" 200 OK
/Users/hasanb/Desktop/MDX-DOCS/CST-4090/code/hdfs-anomaly-detection/enhanced_scoring_service.py:322: DeprecationWarning: `search` method is deprecated and will be removed in the future. Use `query_points` instead.
  results = qdrant_client.search(
2025-09-26 16:07:21,892 - httpx - INFO - HTTP Request: POST http://localhost:6333/collections/logs_embeddings/points/search "HTTP/1.1 200 OK"
2025-09-26 16:07:21,893 - __main__ - INFO - ðŸ”„ Fallback to embedding service
/Users/hasanb/Desktop/MDX-DOCS/CST-4090/code/hdfs-anomaly-detection/enhanced_scoring_service.py:358: DeprecationWarning: `search` method is deprecated and will be removed in the future. Use `query_points` instead.
  high_similarity_results = qdrant_client.search(
2025-09-26 16:07:21,907 - httpx - INFO - HTTP Request: POST http://localhost:6333/collections/logs_embeddings/points/search "HTTP/1.1 200 OK"
/Users/hasanb/Desktop/MDX-DOCS/CST-4090/code/hdfs-anomaly-detection/enhanced_scoring_service.py:366: DeprecationWarning: `search` method is deprecated and will be removed in the future. Use `query_points` instead.
  medium_similarity_results = qdrant_client.search(
2025-09-26 16:07:21,909 - httpx - INFO - HTTP Request: POST http://localhost:6333/collections/logs_embeddings/points/search "HTTP/1.1 200 OK"
2025-09-26 16:07:21,910 - __main__ - INFO - ðŸŽ¯ Weighted Voting: [dt:0(w:0.079), mlp:1(w:0.432), sgd:1(w:0.075), qdrant_similarity:0(w:0.415)] â†’ Score:0.5062 (simple_avg:0.5000)
2025-09-26 16:07:21,910 - __main__ - INFO - ðŸŽ¯ THRESHOLD DECISION: score=0.506212, threshold=0.6, score>threshold=False, prediction=0
/Users/hasanb/Desktop/MDX-DOCS/CST-4090/code/hdfs-anomaly-detection/enhanced_scoring_service.py:699: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
  result_dict = enhanced_result.dict()
2025-09-26 16:07:21,912 - __main__ - INFO -  Cached result for hash cb5e100e... (TTL: 3600s)
2025-09-26 16:07:21,912 - __main__ - INFO - âœ… NORMAL: error... (score: 0.506, qdrant_vote: 0, similar: 0, time: 37.7ms)
/Users/hasanb/Desktop/MDX-DOCS/CST-4090/code/hdfs-anomaly-detection/enhanced_scoring_service.py:710: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
  result_dict = enhanced_result.dict()
INFO:     127.0.0.1:62143 - "POST /score HTTP/1.1" 200 OK
